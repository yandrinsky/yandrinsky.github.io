(()=>{"use strict";var e={223:(e,t,s)=>{s.d(t,{Z:()=>o});var n=s(933),i=s.n(n),r=s(476),a=s.n(r)()(i());a.push([e.id,"body{\r\n    margin: 0;\r\n    padding: 0;\r\n}\r\n#canvas{\r\n    border: 1px solid black;\r\n    display: block;\r\n}\r\n\r\n.saved_code{\r\n    display: inline-block;\r\n    position: absolute;\r\n    left: -1000px;\r\n}\r\n\r\n.saveOk{\r\n    background-color: yellowgreen;\r\n}",""]);const o=a},476:e=>{e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var s="",n=void 0!==t[5];return t[4]&&(s+="@supports (".concat(t[4],") {")),t[2]&&(s+="@media ".concat(t[2]," {")),n&&(s+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),s+=e(t),n&&(s+="}"),t[2]&&(s+="}"),t[4]&&(s+="}"),s})).join("")},t.i=function(e,s,n,i,r){"string"==typeof e&&(e=[[null,e,void 0]]);var a={};if(n)for(var o=0;o<this.length;o++){var c=this[o][0];null!=c&&(a[c]=!0)}for(var l=0;l<e.length;l++){var d=[].concat(e[l]);n&&a[d[0]]||(void 0!==r&&(void 0===d[5]||(d[1]="@layer".concat(d[5].length>0?" ".concat(d[5]):""," {").concat(d[1],"}")),d[5]=r),s&&(d[2]?(d[1]="@media ".concat(d[2]," {").concat(d[1],"}"),d[2]=s):d[2]=s),i&&(d[4]?(d[1]="@supports (".concat(d[4],") {").concat(d[1],"}"),d[4]=i):d[4]="".concat(i)),t.push(d))}},t}},933:e=>{e.exports=function(e){return e[1]}},892:e=>{var t=[];function s(e){for(var s=-1,n=0;n<t.length;n++)if(t[n].identifier===e){s=n;break}return s}function n(e,n){for(var r={},a=[],o=0;o<e.length;o++){var c=e[o],l=n.base?c[0]+n.base:c[0],d=r[l]||0,u="".concat(l," ").concat(d);r[l]=d+1;var h=s(u),m={css:c[1],media:c[2],sourceMap:c[3],supports:c[4],layer:c[5]};if(-1!==h)t[h].references++,t[h].updater(m);else{var v=i(m,n);n.byIndex=o,t.splice(o,0,{identifier:u,updater:v,references:1})}a.push(u)}return a}function i(e,t){var s=t.domAPI(t);return s.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;s.update(e=t)}else s.remove()}}e.exports=function(e,i){var r=n(e=e||[],i=i||{});return function(e){e=e||[];for(var a=0;a<r.length;a++){var o=s(r[a]);t[o].references--}for(var c=n(e,i),l=0;l<r.length;l++){var d=s(r[l]);0===t[d].references&&(t[d].updater(),t.splice(d,1))}r=c}}},311:e=>{var t={};e.exports=function(e,s){var n=function(e){if(void 0===t[e]){var s=document.querySelector(e);if(window.HTMLIFrameElement&&s instanceof window.HTMLIFrameElement)try{s=s.contentDocument.head}catch(e){s=null}t[e]=s}return t[e]}(e);if(!n)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");n.appendChild(s)}},60:e=>{e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},192:(e,t,s)=>{e.exports=function(e){var t=s.nc;t&&e.setAttribute("nonce",t)}},760:e=>{e.exports=function(e){var t=e.insertStyleElement(e);return{update:function(s){!function(e,t,s){var n="";s.supports&&(n+="@supports (".concat(s.supports,") {")),s.media&&(n+="@media ".concat(s.media," {"));var i=void 0!==s.layer;i&&(n+="@layer".concat(s.layer.length>0?" ".concat(s.layer):""," {")),n+=s.css,i&&(n+="}"),s.media&&(n+="}"),s.supports&&(n+="}");var r=s.sourceMap;r&&"undefined"!=typeof btoa&&(n+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(r))))," */")),t.styleTagTransform(n,e,t.options)}(t,e,s)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},865:e=>{e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},283:(e,t,s)=>{function n(e){return Math.sqrt((e.x2-e.x1)**2+(e.y2-e.y1)**2)}function i(e,t,s){return void 0!==t?t*e.k-e.b:void 0!==s?(s-e.b)/e.k:void 0}function r(e,t,s,n){return{x1:e,y1:t,x2:s,y2:n,xTop:-e,xBottom:s-e,yTop:-t,yBottom:n-t,k:(n-t)/(s-e),b:e*(n-t)/(s-e)-t}}function a(e,t,s){const n=-1/s.k,i=Math.sqrt((s.x1-e)**2+(s.y1-t)**2);return{xTop:-e,xBottom:-(s.xTop||1)/s.xBottom,yTop:-t,yBottom:(s.yTop||1)/s.yBottom,k:n,b:(s.y2-s.y1>=0?-1:1)*Math.sqrt((i*n)**2+i**2)-(s.y1+s.x1/s.k)}}function o(e,t,s){let n=Math.sqrt((e.x2-e.x1)**2+(e.y2-e.y1)**2);Math.abs(e.x2-e.x1),Math.abs(e.y2-e.y1);const r=e.x2-e.x1<0?-1:1;let a;void 0===s?a=n+t:void 0!==s&&(a=Math.sqrt((s-e.x1)**2+(i(e,s)-e.y1)**2)+t);let o=a/n,c=Math.abs(o*Math.abs(e.x2-e.x1)+r*e.x1);return{x:c,y:i(e,c)}}function c(e,t=[],s=[]){e.distance||(e.distance=1),t&&t instanceof Function&&(t=[t]),s&&s instanceof Function&&(s=[s]);const{userX:n,userY:i,x1:r,y1:a,y2:o,x2:c}=e;let l=function(e){function t(e,t,s,n){return Math.sqrt((s-e)**2+(n-t)**2)}const{x0:s,y0:n,x1:i,y1:r,x2:a,y2:o}=e;let c=t(s,n,i,r),l=t(s,n,a,o),d=t(i,r,a,o);if(c<t(l,d,0,0)&&l<t(c,d,0,0)){let e=o-r,c=i-a,l=-i*(o-r)+r*(a-i),d=t(e,c,0,0);l>0&&(e=-e,c=-c,l=-l);let u=(e*s+c*n+l)/d;return u>-5&&u<5}return!1}({x0:n,y0:i,x1:r,y1:a,x2:c,y2:o});return l?t.forEach((t=>{t(e.e)})):s.forEach((t=>{t(e.e)})),l}function l(e,t=[],s=[]){e.distance||(e.distance=1),t&&(t=t instanceof Function?[t]:[()=>{}]),s&&(s=s instanceof Function?[s]:[()=>{}]);const{userX:n,userY:i,x0:r,y0:a}=e;return n<r+10&&n>r-10&&i<a+10&&i>a-10?(t.forEach((t=>{t(e.e)})),!0):(s.forEach((t=>{t(e.e)})),!1)}s.r(t),s.d(t,{getCoordinates:()=>i,getEquationFor2points:()=>r,getEquationForLine:()=>a,moveTo:()=>o,nearLine:()=>c,nearDot:()=>l,length:()=>n})}},t={};function s(n){var i=t[n];if(void 0!==i)return i.exports;var r=t[n]={id:n,exports:{}};return e[n](r,r.exports,s),r.exports}s.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return s.d(t,{a:t}),t},s.d=(e,t)=>{for(var n in t)s.o(t,n)&&!s.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e=s(892),t=s.n(e),n=s(760),i=s.n(n),r=s(311),a=s.n(r),o=s(192),c=s.n(o),l=s(60),d=s.n(l),u=s(865),h=s.n(u),m=s(223),v={};v.styleTagTransform=h(),v.setAttributes=c(),v.insert=a().bind(null,"head"),v.domAPI=i(),v.insertStyleElement=d(),t()(m.Z,v),m.Z&&m.Z.locals&&m.Z.locals;const f=function(){let e=String(Math.random());return e.replace(".",""),e};var y=s(283);const p={state:{__shapes:{},shapes:{},mouseover:{},mouseleave:{},mouseenter:{},click:{},__mouseMoveTargets:[],__mouseClickTargets:[],shouldRenderUpdates:!0,shift:{x:0,y:0},draggableCanvas:!1},getState(){return this.state},setState(e){this.state=e}},x=function(e,t){let s=p.getState();return{clientY:e.clientY,clientX:e.clientX,altKey:e.altKey,button:e.button,ctrlKey:e.ctrlKey,layerX:e.layerX,layerY:e.layerY,movementX:e.movementX,movementY:e.movementY,currentTarget:e.currentTarget,offsetX:e.offsetX,offsetY:e.offsetY,pageX:e.pageX,pageY:e.pageY,x:e.x-s.shift.x,y:e.y-s.shift.y,which:e.which,target:t,shiftKey:e.shiftKey}},g=function(e){let t=!1;const s=(e,s)=>{let n=x(s,this.state.shapes[e.id]);this.state.mouseover[e.id]&&(this.state.mouseover[e.id](n),t=!0),this.state.mouseenter[e.id]&&(e.events.mouseenter||(this.state.mouseenter[e.id](n),e.events.mouseenter=!0,t=!0)),this.state.mouseleave[e.id]&&(e.events.mouseleave=!0)},n=(e,s)=>{let n=x(s,this.state.shapes[e.id]);this.state.mouseleave[e.id]&&e.events.mouseenter&&(this.state.mouseleave[e.id](n),e.events.mouseenter=!1,t=!0),this.state.mouseenter[e.id]&&(e.events.mouseenter=!1)};for(let t=0;t<this.state.__mouseMoveTargets.length;t++){let i=this.state.__shapes[this.state.__mouseMoveTargets[t]];"line"===i.type?(0,y.nearLine)({distance:5,userX:e.clientX,userY:e.clientY,x1:i.start.x+this.state.shift.x,y1:i.start.y+this.state.shift.y,x2:i.end?.x+this.state.shift.x||i.start.x+this.state.shift.x,y2:i.end?.y+this.state.shift.y||i.start.y+this.state.shift.y},s.bind(this,i,e),n.bind(this,i,e)):"circle"===i.type&&(0,y.nearDot)({distance:5,userX:e.clientX,userY:e.clientY,x0:i.start.x+this.state.shift.x,y0:i.start.y+this.state.shift.y},s.bind(this,i,e),n.bind(this,i,e))}t&&this.render()},k=function(e){for(let t=0;t<this.state.__mouseClickTargets.length;t++){let s=this.state.__shapes[this.state.__mouseClickTargets[t]];"line"===s.type?(0,y.nearLine)({distance:5,userX:e.clientX,userY:e.clientY,x1:s.start.x+this.state.shift.x,y1:s.start.y+this.state.shift.y,x2:s.end.x+this.state.shift.x,y2:s.end.y+this.state.shift.y,e},(e=>{this.state.click[s.id]&&this.state.click[s.id](x(e,this.state.shapes[s.id]))})):"circle"===s.type&&(0,y.nearDot)({distance:5,userX:e.clientX,userY:e.clientY,x0:s.start.x+this.state.shift.x,y0:s.start.y+this.state.shift.y,e},(e=>{this.state.click[s.id]&&this.state.click[s.id](x(e,this.state.shapes[s.id]))}))}},C=class{constructor(e,t){this.link=e,this.id=t,this.isPointer=!1}get system(){const e=this;return{get equation(){if("line"===e.link.type)return(0,y.getEquationFor2points)(e.link.start.x,e.link.start.y,e.link.end.x,e.link.end.y)},get coordinates(){let t=e.link.start.x,s=e.link.start.y,n=e.link.end?.x,i=e.link.end?.y;return{x1:t,y1:s,x2:n,y2:i}},getCoordinatesX(e){return(0,y.getCoordinates)(this.equation,void 0,e)},getCoordinatesY(e){return(0,y.getCoordinates)(this.equation,e,void 0)},moveTo(e,t){return(0,y.moveTo)(this.equation,e,t)},get length(){return(0,y.length)(this.equation)}}}get classList(){let e=this.link;return{add(t){e.classList.includes(t)||(e.classList.push(t),P.render())},remove(t){const s=e.classList.indexOf(t);-1!==s&&(e.classList.splice(s,1),P.render())},toggle(t){const s=e.classList.indexOf(t);s?(e.classList.splice(s,1),P.render()):(e.classList.push(t),P.render())},contains:t=>e.classList.includes(t)}}get update(){const e=this.link;return{get startPosition(){return{set x(t){e.start.x=t,P.render()},set y(t){e.start.y=t,P.render()}}},get endPosition(){return{set x(t){e.end.x=t,P.render()},set y(t){e.end.y=t,P.render()}}}}}set pointer(e){this.isPointer=!!e,this.link.pointer=this.isPointer}set onmouseover(e){P.state.mouseover[this.id]=e,P.state.__mouseMoveTargets.includes(this.id)||P.state.__mouseMoveTargets.push(this.id)}set onmouseenter(e){P.state.mouseenter[this.id]=e,P.state.__mouseMoveTargets.includes(this.id)||P.state.__mouseMoveTargets.push(this.id)}set onmouseleave(e){P.state.mouseleave[this.id]=e,P.state.__mouseMoveTargets.includes(this.id)||P.state.__mouseMoveTargets.push(this.id)}set onclick(e){P.state.__mouseClickTargets.includes(this.id)||P.state.__mouseClickTargets.push(this.id),P.state.click[this.id]=e}remove(){delete P.state.__shapes[this.id],delete P.state.shapes[this.id],delete P.state.mouseenter[this.id],delete P.state.mouseleave[this.id],delete P.state.mouseenter[this.id],delete P.state.click[this.id];let e=P.state.__mouseMoveTargets,t=P.state.__mouseClickTargets;e.indexOf(this.id)>=0&&e.splice(e.indexOf(this.id),1),t.indexOf(this.id)>=0&&t.splice(t.indexOf(this.id),1),P.render()}};function _(e,t,s){let n={...{line:{lineWidth:5,color:"black"},circle:{startAngle:0,endAngle:2*Math.PI,radius:10,color:"black"}}[s]};return t.forEach((t=>{n={...n,...e[t]}})),n}const{getEquationFor2points:L,moveTo:b,getEquationForLine:E,getCoordinates:S}=s(283),w=function(e){!function(e){e.context.beginPath(),e.context.moveTo(0,0),e.context.fillStyle=e.backgroundColor,e.context.fillRect(0,0,e.canvas.width,e.canvas.height)}({backgroundColor:"white",context:e.context,canvas:e.canvas});const t=function(e,t){const s={};for(let n in t){let i,r=t[n];r.classList.forEach((t=>{e[t]?.zIndex&&(i=e[t].zIndex)})),void 0===i&&(i=0),s.hasOwnProperty(i)?s[i].push(r):s[i]=[r]}return{shapes:s,keys:Object.keys(s).sort(((e,t)=>e-t))}}(e.css,e.elements);t.keys.forEach((s=>{t.shapes[s].forEach((t=>{"line"===t.type?function(e){const t=_(e.css,e.link.classList,e.link.type);if("hidden"!==t.visibility)if(e.context.beginPath(),e.context.moveTo(e.link.start.x+e.shift.x,e.link.start.y+e.shift.y),e.link.pointer){const s=P.getElementByUniqueId(e.link.id).system.equation,n=(0,y.moveTo)(s,-5);e.context.lineTo(n.x+e.shift.x,n.y+e.shift.y),e.context.lineWidth=t.lineWidth,e.context.strokeStyle=t.color,e.context.stroke()}else e.context.lineTo(e.link.end.x+e.shift.x,e.link.end.y+e.shift.y),e.context.lineWidth=t.lineWidth,e.context.strokeStyle=t.color,e.context.stroke()}({link:t,context:e.context,css:e.css,shift:e.shift}):"circle"===t.type&&function(e){const t=_(e.css,e.link.classList,e.link.type);"hidden"!==t.visibility&&(e.context.beginPath(),e.context.fillStyle=t.color,e.context.arc(e.link.start.x+e.shift.x,e.link.start.y+e.shift.y,t.radius,t.startAngle,t.endAngle),e.context.fill())}({link:t,context:e.context,css:e.css,shift:e.shift})}))})),function(e){P.querySelectorAll("line").forEach((t=>{t.isPointer&&function(e,t,s){const n={x0:e.start.x+s.x,y0:e.start.y+s.y,x1:e.end.x+s.x,y1:e.end.y+s.y};if(n.x1<3)return;let i=L(n.x0,n.y0,n.x1,n.y1),r=b(i,-10),a=E(r.x,r.y,i);a.x1=r.x-50,a.y1=S(a,r.x-50),a.x2=r.x+50,a.y2=S(a,r.x+50);let o=b(a,-5,r.x),c=b(a,5,r.x);t.fillStyle="black",t.beginPath(),t.moveTo(o.x,o.y),t.lineTo(c.x,c.y),t.lineTo(n.x1,n.y1),t.fill()}(t.link,e.context,e.shift)}))}({context:e.context,shift:e.shift})},T={state:p.getState(),context:void 0,canvas:void 0,css:void 0,setCanvas(e){this.canvas=e},setContext(e){this.context=e},setCSS(e){this.css=e},start(){(function(){function e(e){P.canvas.style.cursor="grabbing",P.state.draggableCanvas&&(P.state.shift.x+=e.movementX,P.state.shift.y+=e.movementY,P.render())}P.canvas.addEventListener("mousedown",(function(t){if(P.state.draggableCanvas){for(let e=0;e<P.state.__mouseClickTargets.length;e++){let s=P.state.__shapes[P.state.__mouseClickTargets[e]];if((0,y.nearDot)({distance:5,userX:t.clientX,userY:t.clientY,x0:s.start.x+P.state.shift.x,y0:s.start.y+P.state.shift.y,e:t}))return}P.canvas.style.cursor="grab",P.canvas.addEventListener("mousemove",e)}})),P.canvas.addEventListener("mouseup",(function(t){P.state.draggableCanvas&&(P.canvas.style.cursor="default",P.canvas.removeEventListener("mousemove",e))}))})(),this.canvas.addEventListener("mousemove",g.bind(this)),this.canvas.addEventListener("click",k.bind(this))},settings:{set draggableCanvas(e){T.state.draggableCanvas=!!e}},querySelector(e){return function(e,t,s){for(let n in t){const i=t[n];if("."===e[0]){if(i.classList.includes(e.slice(1)))return s[n]}else if(i.type===e)return s[n]}}(e,this.state.__shapes,this.state.shapes)},querySelectorAll(e){return function(e,t,s){const n=[];for(let i in t){const r=t[i];"."===e[0]?r.classList.includes(e.slice(1))&&n.push(s[i]):r.type===e&&n.push(s[i])}return n}(e,this.state.__shapes,this.state.shapes)},getElementByUniqueId(e){return this.state.shapes[e]},createLine(e){let t=f();this.state.__shapes[t]={start:{x:e.x0,y:e.y0},end:{x:e.x1,y:e.y1},type:"line",id:t,classList:e.className?[e.className]:[],events:{mouseenter:!1}};let s=this.state.__shapes[t],n=new C(s,t);return this.state.shapes[t]=n,n},createCircle(e){let t=f();e.className&&!e.className instanceof Array&&(e.className=[e.className]),this.state.__shapes[t]={start:{x:e.x0,y:e.y0},type:"circle",id:t,classList:e.className?e.className:[],events:{mouseenter:!1}};let s=this.state.__shapes[t],n=new C(s,t);return this.state.shapes[t]=n,n},text(e){this.context.font=`${e.fontSize||14}px serif`,this.context.fillStyle=e.color||"black",this.context.fillText(e.text,e.x,e.y)},render(){this.state.shouldRenderUpdates&&w({css:this.css,canvas:this.canvas,context:this.context,shift:this.state.shift,elements:this.state.__shapes})},preventRender(e){this.state.shouldRenderUpdates=!1,e(),this.state.shouldRenderUpdates=!0},combineRender(e){this.state.shouldRenderUpdates=!1,e(),this.state.shouldRenderUpdates=!0,T.render()},save:()=>JSON.stringify(p.getState()),recover(e){const t=JSON.parse(e);for(let e in t.shapes)t.shapes[e]=new C(t.__shapes[e],e),t.shapes[e].pointer=t.__shapes[e].pointer;p.setState(t),this.state=p.getState(),this.render()}},P=T;class N{constructor(e,t=1){let s=this.gcd(e,t);this.num=e/s,this.det=t/s}gcd(e,t){return 0===t?e:this.gcd(t,e%t)}nok(e,t){return e*t/this.gcd(e,t)}getNum(){return this.num}getDet(){return this.det}setNum(e){const t=this.gcd(e,this.det);return this.num=e/t,this.det/=t,this}setDet(e){const t=this.gcd(e,this.det);return this.det=e/t,this.num/=t,this}plus(e,t=1){e instanceof N&&(t=e.getDet(),e=e.getNum());let s=this.nok(t,this.det),n=this.num*s/this.det+e*s/t,i=this.gcd(s,n);return s/=i,n/=i,this.num=n,this.det=s,this}minus(e,t=1){e instanceof N&&(t=e.getDet(),e=e.getNum());let s=this.nok(t,this.det),n=this.num*s/this.det-e*s/t,i=this.gcd(s,n);return s/=i,n/=i,this.num=n,this.det=s,this}multiply(e,t=1){e instanceof N&&(t=e.getDet(),e=e.getNum());let s=this.gcd(this.num*e,this.det*t);return this.num=this.num*e/s,this.det=this.det*t/s,this}divide(e,t=1){e instanceof N&&(t=e.getDet(),e=e.getNum());let s=this.gcd(this.num*t,this.det*e);return this.num=this.num*t/s,this.det=this.det*e/s,this}getStr(){return 1===this.det?`${this.num}`:0===this.num?"0":`${this.num}/${this.det}`}clone(){return new N(this.num,this.det)}}const I=N,O={mode:"analyze",count:0,path:void 0,results:{}},q=function(e){P.combineRender((()=>{P.querySelectorAll(".finishLine").forEach((e=>e.classList.remove("finishLine")))})),O.results={};let t=Object.keys(e).map((t=>e[t])),s=[],n=[],i=new I(0);for(let t in e)0===e[t].parents.length&&s.push(e[t]),0===e[t].children.length&&n.push(e[t]);if(s.length>1)return alert("Путь имеет разрывы. Анализ невозможен"),void console.log(s);let r=[];t.forEach(((e,n)=>{let i=[];for(let e=0;e<=t.length;e++)i.push(new I(0));e.parents.forEach((e=>{i[t.indexOf(e)]=new I(1,-e.children.length)})),i[t.indexOf(e)]=new I(1),e===s[0]&&(i[i.length-1]=new I(1)),r.push(i)}));let a=function(e){let t,s,n,i=e.length,r=new Array(i);for(t=0;t<i;++t)r[t]=new Array(i);function a(r){for(t=r+1;t<i;t++)if(0!==e[t][r])for(s=0;s<=i;s++)n=e[t-1][s],e[t-1][s]=e[t][s],e[t][s]=n}return function(o){for(o=0;o<i-1;o++){for(0===e[o][o].getNum()&&a(o),s=i;s>=o;s--)e[o][s].divide(e[o][o]);for(t=o+1;t<i;t++)for(s=i;s>=o;s--)e[t][s].minus(e[o][s].clone().multiply(e[t][o]))}return function(){for(r[i-1]=e[i-1][i].clone().divide(e[i-1][i-1]),t=i-2;t>=0;t--){for(n=new I(0),s=i-1;s>t;s--)n.plus(e[t][s].clone().multiply(r[s]));r[t]=e[t][i].clone().minus(n)}}(),r}(i)}(r);t.forEach(((e,t)=>{e.power=a[t]})),n.forEach((e=>{e.line.classList.add("finishLine"),function(e){e.auxiliary=e.aux||e.auxiliary,e.aux=e.auxiliary||e.aux,e.output[e.target.ids.line]={text:e.auxiliary?e.text:e.target.power.getStr(),x:e.target.endCircle.link.start.x+10+P.state.shift.x,y:e.target.endCircle.link.start.y-10+P.state.shift.y,fontSize:"14",color:"green",data:e.auxiliary?void 0:{num:e.target.power.getNum(),det:e.target.power.getDet()},auxiliary:e.auxiliary||!1}}({target:e,output:O.results})})),P.render();for(let e in O.results)O.results[e].auxiliary||i.plus(O.results[e].data.num,O.results[e].data.det),P.text(O.results[e]);"1"!==i.getStr()&&alert("Критическая ошибка анализа пути: сумма выходов равна: "+i.getStr())},M={state:{delMode:!1,mode:"draw",deletingIndex:void 0,isDragging:!1,lines:{}},stack:{length:0,stack_limit:7,current:-1},system:{canvas:void 0,context:void 0},setCanvas(e){this.system.canvas=e},setContext(e){this.system.context=e},getState(){return this.state},getStackPrev(){return this.stack.current-1>=0?this.stack.current-=1:this.stack.current=0,this.stack[this.stack.current]},getStackNext(){return this.stack.current+1<this.stack.stack_limit?this.stack.current+=1:this.stack.current=this.stack.stack_limit,this.stack[this.stack.current]},addToStack(e){if(this.stack.length!==this.stack.current+1){for(let e=this.stack.current+1;e<this.stack.stack_limit;e++)delete this.stack[e];this.stack.length=this.stack.current+1}if(this.stack.length<this.stack.stack_limit)this.stack[this.stack.length]=e,this.stack.length+=1,this.stack.current+=1;else{for(let e=1;e<this.stack.length;e++)this.stack[e-1]=this.stack[e];this.stack[this.stack.length-1]=e}},get canvas(){return this.system.canvas},get context(){return this.system.context}},X=function(e){P.preventRender((()=>{P.querySelectorAll(".finishLine").forEach((e=>{e.classList.remove("finishLine"),e.classList.add("__PLACE_FOR_FINISH_LINE")}))}));const t=function(e,t,s){const n={...e,lines:{}};for(let t in e.lines){let s=e.lines[t],i=[],r=[],a=[];s.children.forEach((e=>{i.push(e.line.id)})),s.parents.forEach((e=>{r.push(e.line.id)})),s.sideIn.forEach((e=>{a.push(e.line.id)})),n.lines[t]={...s,line:s.line.id,endCircle:s.endCircle.id,startCircle:s.startCircle.id,children:i,parents:r,sideIn:a}}const i=JSON.stringify({SCRIPT:JSON.stringify(n),CNV:t});return s||localStorage.setItem("__saved",i),i}(M.state,P.save(),e.dont_save);return P.preventRender((()=>{P.querySelectorAll(".__PLACE_FOR_FINISH_LINE").forEach((e=>{e.classList.remove("__PLACE_FOR_FINISH_LINE"),e.classList.add("finishLine")}))})),t};function Y(e,t){e.children.push(t),e.__NOT_CIRCLE?(e.endCircle.classList.remove("hidden"),e.endCircle.classList.add("stickyCircle")):e.endCircle.classList.remove("hidden")}function A(e){let t=M.state.lines[e];t.line.remove(),t.startCircle.remove(),t.endCircle.remove(),t.parents.length>0&&t.parents.forEach((e=>{e.children.splice(e.children.indexOf(t),1),0===e.children.length&&e.endCircle.classList.add("hidden")})),t.children.length>0&&t.children.forEach((e=>{e.parents.splice(e.parents.indexOf(t),1),e.sideIn.includes(t)&&e.sideIn.splice(e.sideIn.indexOf(t),1)})),delete M.state.lines[e]}function F(e,t={}){let s=P.createLine({x0:t.x0||e.clientX,y0:t.y0||e.clientY,x1:t.x0||e.clientX,y1:t.y0||e.clientY,className:"red"}),n=P.createCircle({x0:t.x0||e.clientX,y0:t.y0||e.clientY,className:["red","hidden"]}),i=P.createCircle({x0:t.x0||e.clientX,y0:t.y0||e.clientY,className:["endCircle","hidden"]});s.pointer=!0;let r={line:s,startCircle:n,endCircle:i,parents:[],children:[],sideIn:[],ids:{line:s.id,endCircle:i.id,startCircle:n.id},id:f()};return s.onmouseenter=e=>U(r,e),s.onmouseleave=e=>j(r,e),i.onmouseenter=e=>z(e),i.onmouseleave=e=>H(e),M.state.lines[s.id]=r,r}const R=function(e,t=(()=>{})){function s(t){e.line.update.endPosition.x=t.clientX-P.state.shift.x,e.line.update.endPosition.y=t.clientY-P.state.shift.y,e.endCircle.update.startPosition.x=t.clientX-P.state.shift.x,e.endCircle.update.startPosition.y=t.clientY-P.state.shift.y}M.canvas.addEventListener("mousemove",s),M.canvas.addEventListener("click",(function n(i){i.preventDefault(),M.canvas.removeEventListener("mousemove",s),M.canvas.removeEventListener("click",n),e.endCircle.onclick=t=>K(e,t),t(),function(){for(let e in M.state.lines){let t=M.state.lines[e];t.line.onmouseenter=e=>U(t,e),t.line.onmouseleave=e=>j(t,e),t.line.onclick=e=>{}}}(),M.addToStack(X({dont_save:!0}))})),function(e){e.line.onmouseenter=void 0,e.line.onmouseleave=void 0,e.line.onclick=void 0,e.startCircle.onmouseenter=void 0,e.startCircle.onmouseleave=void 0,e.startCircle.onclick=void 0;for(let t in M.state.lines){let s=M.state.lines[t];s.ids.line!==e.ids.line&&(s.parents.length>0?(s.line.onmouseenter=e=>{e.target.classList.add("stickyLine")},s.line.onmouseleave=e=>{e.target.classList.remove("stickyLine")},setTimeout((()=>{s.line.onclick=t=>{s.line.classList.remove("stickyLine");const n=s.line.system.moveTo(s.line.system.length/2,s.line.system.coordinates.x1);e.line.update.endPosition.x=n.x,e.line.update.endPosition.y=n.y,e.endCircle.update.startPosition.x=n.x,e.endCircle.update.startPosition.y=n.y,e.endCircle.classList.add("hidden"),e.__NOT_CIRCLE=!0,s.parents.push(e),s.sideIn.push(e),Y(e,s)}}),10)):(s.startCircle.onmouseenter=e=>{e.target.classList.add("startCircleActive"),e.target.classList.remove("hidden")},s.startCircle.onmouseleave=e=>{e.target.classList.remove("startCircleActive"),e.target.classList.add("hidden")},setTimeout((()=>{s.line.onclick=t=>{s.line.classList.remove("stickyLine");const n=s.line.system.coordinates;e.line.update.endPosition.x=n.x1,e.line.update.endPosition.y=n.y1,e.endCircle.update.startPosition.x=n.x1,e.endCircle.update.startPosition.y=n.y1,e.endCircle.classList.remove("hidden"),s.parents.push(e),Y(e,s)}}),10)))}}(e)};function D(){Object.keys(M.state.lines).forEach((e=>{M.state.lines[e].endCircle.onclick=void 0}))}function B(){Object.keys(M.state.lines).forEach((e=>{M.state.lines[e].endCircle.onclick=t=>K(M.state.lines[e],t)}))}function U(e,t){t.target.classList.add("black"),0===e.children.length&&e.endCircle.classList.remove("hidden")}function j(e,t){t.target.classList.remove("black"),0===e.children.length&&e.endCircle.classList.add("hidden")}function z(e){e.target.classList.add("endCircleActive")}function H(e){e.target.classList.remove("endCircleActive")}function K(e,t){if(P.settings.draggableCanvas=!1,P.querySelectorAll(".finishLine").forEach((e=>e.classList.remove("finishLine"))),e.line.classList.remove("black"),e.children.length<2){D();const s=F(t,{x0:e.endCircle.link.start.x,y0:e.endCircle.link.start.y});s.parents.push(e),Y(e,s),s.line.onmouseenter=void 0,s.line.onmouseleave=void 0,R(s,(()=>{B(),s.line.onmouseenter=e=>U(s,e),s.line.onmouseleave=e=>j(s,e),setTimeout((()=>{P.settings.draggableCanvas=!0}),100)}))}}const W=e=>{if("Shift"===e.key){P.settings.draggableCanvas=!1,window.removeEventListener("keydown",W),window.addEventListener("keyup",J);for(let e in M.state.lines){let t=M.state.lines[e],s=t.endCircle;function n(e,t){const s=t.endCircle;P.combineRender((()=>{s.update.startPosition.x=e.clientX-P.state.shift.x,s.update.startPosition.y=e.clientY-P.state.shift.y,t.line.update.endPosition.x=s.link.start.x,t.line.update.endPosition.y=s.link.start.y,t.parents.forEach((e=>{if(e.__NOT_CIRCLE){const s=t.line.system.moveTo(t.line.system.length/2,t.line.system.coordinates.x1);e.line.update.endPosition.x=s.x,e.line.update.endPosition.y=s.y,e.endCircle.update.startPosition.x=s.x,e.endCircle.update.startPosition.y=s.y}})),t.children.forEach((e=>{e.line.update.startPosition.x=s.link.start.x,e.line.update.startPosition.y=s.link.start.y,e.startCircle.update.startPosition.x=s.link.start.x,e.startCircle.update.startPosition.y=s.link.start.y,e.parents.forEach((s=>{if(s!==t){const t=e.line.system.moveTo(e.line.system.length/2,e.line.system.coordinates.x1);s.line.update.endPosition.x=t.x,s.line.update.endPosition.y=t.y,s.endCircle.update.startPosition.x=t.x,s.endCircle.update.startPosition.y=t.y}}))}))}))}function i(e){M.canvas.style.cursor="default",document.onmousemove=void 0,M.canvas.onmousedown=void 0,M.canvas.onmouseup=void 0}s.onclick=void 0,s.onmouseenter=e=>{M.canvas.style.cursor="move",M.canvas.onmousedown=e=>{document.onmousemove=e=>n(e,t),s.onmouseleave=void 0},M.canvas.onmouseup=e=>{0===e.button&&(document.onmousemove=void 0,s.onmouseleave=i)}},s.onmouseleave=i}return()=>{document.removeEventListener("mousemove",onMouseMove3),M.canvas.onmousedown=void 0,M.canvas.onmouseup=void 0}}},J=e=>{if("Shift"===e.key){P.settings.draggableCanvas=!0,M.canvas.style.cursor="default",window.removeEventListener("keyup",J),window.addEventListener("keydown",W),M.canvas.onmousedown=void 0,M.canvas.onmouseup=void 0,document.onmousemove=void 0;for(let e in M.state.lines){let t=M.state.lines[e],s=t.endCircle;s.onmouseenter=z,s.onmouseleave=H,s.onclick=e=>K(t,e)}}},Z=function(e){const t=JSON.parse(e||localStorage.getItem("__saved"));P.recover(t.CNV);let s=JSON.parse(t.SCRIPT);for(let e in s.lines){let t=s.lines[e];t.line=P.getElementByUniqueId(t.line),t.endCircle=P.getElementByUniqueId(t.endCircle),t.startCircle=P.getElementByUniqueId(t.startCircle),t.children=t.children.map((e=>s.lines[e])),t.parents=t.parents.map((e=>s.lines[e])),t.sideIn=t.sideIn.map((e=>s.lines[e])),t.line.onmouseenter=e=>U(t,e),t.line.onmouseleave=e=>j(t,e),t.endCircle.onmouseenter=e=>z(e),t.endCircle.onmouseleave=e=>H(e),t.endCircle.onclick=e=>K(t,e)}Object.keys(s.lines).length>0&&(M.canvas.onclick=void 0),M.state=s,P.settings.draggableCanvas=!0},$=document.querySelector("#canvas"),V=document.querySelector("#delLine"),G=document.querySelector("#recover"),Q=document.querySelector("#analyze"),ee=document.querySelector("#mode"),te=document.querySelector(".saved_code"),se=document.querySelector("#save");$.width=window.innerWidth-5,$.height=window.innerHeight-100;let ne=$.getContext("2d");function ie(){$.onclick=e=>{const t=F(e);$.onclick=void 0,R(t,(()=>{$.onclick=void 0,P.settings.draggableCanvas=!0}))}}P.setContext(ne),P.setCanvas($),P.setCSS({green:{color:"green",lineWidth:3},red:{color:"red",lineWidth:3},black:{color:"black"},pointer:{color:"black",radius:3},endCircle:{color:"red",radius:8,zIndex:1},endCircleActive:{color:"black"},stickyCircle:{radius:5,color:"blue"},finishLine:{color:"blue"},stickyLine:{color:"gray"},startCircleActive:{color:"gray"},hidden:{visibility:"hidden"},ignore:{},smallCircle:{radius:3,color:"yellow"},orange:{color:"#FF4E39FF"},a1:{color:"#EE82EE"},a2:{color:"green"},a3:{color:"#CD853F"},a4:{color:"#8A2BE2"},a5:{color:"#00CED1"},a6:{color:"#DAA520"},a7:{color:"#98FB98"},a8:{color:"#00FF7F"},a9:{color:"brown"}}),P.settings.draggableCanvas=!1,P.start(),M.setCanvas($),M.setContext(ne),ie(),V.onclick=e=>{"draw"===M.state.mode?function(){P.settings.draggableCanvas=!1,M.state.mode="del",D(),$.style.cursor="crosshair",ee.innerHTML="Режим: удаление";for(let e in M.state.lines)M.state.lines[e].line.onclick=t=>{A(e)};$.onclick=void 0}():"del"===M.state.mode&&function(){P.settings.draggableCanvas=!0,0===Object.keys(M.state.lines).length&&ie(),M.state.mode="draw",B(),$.style.cursor="default",ee.innerHTML="Режим: рисование";for(let e in M.state.lines)M.state.lines[e].line.onclick=e=>{}}()},G.onclick=e=>{Z()},Q.onclick=e=>{q(M.state.lines)},se.onclick=e=>{se.classList.remove("saveOk");const t=P.save(),s=X({}),n=JSON.stringify({CNV:t,SCRIPT:s});te.value=n,te.select(),document.execCommand("copy"),se.classList.add("saveOk"),setTimeout((()=>{se.classList.remove("saveOk")}),1e3)},window.addEventListener("keydown",W),window.onresize=e=>{$.width=window.innerWidth-5,$.height=window.innerHeight-100,P.render()},window.addEventListener("keydown",(e=>{"Z"===e.key&&e.ctrlKey&&e.shiftKey?Z(M.getStackNext()):"z"===e.key&&e.ctrlKey&&Z(M.getStackPrev())}))})()})();